<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premiot Calculator â€” Allison Edition</title>
<!-- Preconnect for faster font loading -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<!-- Load Heebo font; fallback to system Hebrew-friendly fonts if offline -->
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;800&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
<noscript><link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;600;700;800&display=swap" rel="stylesheet"></noscript>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: #0a0f1e;
    font-family: 'Heebo', 'Arial Hebrew', 'David', Arial, sans-serif;
    direction: rtl;
    color: #f1f5f9;
    min-height: 100vh;
    padding-bottom: 60px;
  }

  .header {
    background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%);
    border-bottom: 1px solid rgba(37,99,235,0.3);
    padding: 28px 20px 20px;
    text-align: center;
  }
  .header .sub { font-size: 11px; color: #3b82f6; font-weight: 700; letter-spacing: 0.18em; margin-bottom: 8px; }
  .header h1 { font-size: 26px; font-weight: 800; color: #f1f5f9; }
  .header p { margin-top: 5px; color: #64748b; font-size: 13px; }

  .container { max-width: 720px; margin: 0 auto; padding: 20px 14px; }

  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
  @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }

  .section-title {
    display: flex; align-items: center; gap: 8px;
    margin-bottom: 10px; margin-top: 20px;
  }
  .section-title span { font-size: 11px; font-weight: 700; color: #475569; text-transform: uppercase; letter-spacing: 0.08em; }
  .section-title .line { flex: 1; height: 1px; background: rgba(255,255,255,0.06); }

  .input-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 9px 12px; border-radius: 8px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    margin-bottom: 5px; gap: 8px;
  }
  .input-row label { font-size: 13px; color: #cbd5e1; flex: 1; }
  .input-row .unit { font-size: 11px; color: #64748b; white-space: nowrap; }
  .input-row input {
    width: 80px; padding: 5px 7px; border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.08);
    color: #f1f5f9; font-size: 14px; font-weight: 600;
    text-align: center; outline: none; font-family: monospace;
  }
  .input-row input:focus { border-color: rgba(37,99,235,0.5); background: rgba(37,99,235,0.08); }

  /* Tooltip */
  .tip-btn {
    display: inline-flex; align-items: center; justify-content: center;
    width: 17px; height: 17px; border-radius: 50%; background: #2563eb;
    color: #fff; font-size: 10px; font-weight: 700; cursor: pointer;
    border: none; user-select: none; flex-shrink: 0; position: relative;
  }
  .tip-box {
    display: none; position: absolute; bottom: calc(100% + 8px); right: 0;
    background: #1e293b; color: #e2e8f0; border-radius: 8px;
    padding: 10px 14px; font-size: 12px; line-height: 1.7; z-index: 999;
    width: 240px; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    white-space: pre-line; text-align: right; border: 1px solid rgba(255,255,255,0.1);
    pointer-events: none;
  }
  .tip-btn.open .tip-box { display: block; }

  .result-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 12px; border-radius: 8px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.06);
    margin-bottom: 4px;
  }
  .result-row.accent {
    background: rgba(37,99,235,0.12);
    border-color: rgba(37,99,235,0.35);
  }
  .result-row .rlabel { font-size: 12px; color: #94a3b8; }
  .result-row .rvalue { font-size: 14px; font-weight: 700; color: #e2e8f0; font-family: monospace; }
  .result-row.accent .rlabel { color: #93c5fd; }
  .result-row.accent .rvalue { color: #3b82f6; }

  .alert {
    border-radius: 10px; padding: 12px 14px; margin-bottom: 14px;
  }
  .alert.danger { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.4); }
  .alert.warning { background: rgba(251,191,36,0.08); border: 1px solid rgba(251,191,36,0.3); }
  .alert.success { background: rgba(34,197,94,0.08); border: 1px solid rgba(34,197,94,0.3); }
  .alert .atitle { font-size: 13px; font-weight: 700; margin-bottom: 4px; }
  .alert.danger .atitle { color: #ef4444; }
  .alert.warning .atitle { color: #fbbf24; }
  .alert.success .atitle { color: #22c55e; }
  .alert .abody { font-size: 12px; line-height: 1.6; }
  .alert.danger .abody { color: #fca5a5; }
  .alert.warning .abody { color: #fde68a; }
  .alert.success .abody { color: #86efac; }

  .total-box {
    background: linear-gradient(135deg, rgba(37,99,235,0.2), rgba(29,78,216,0.1));
    border: 1px solid rgba(37,99,235,0.5);
    border-radius: 14px; padding: 20px 16px; text-align: center; margin-top: 16px;
  }
  .total-box .tlabel { font-size: 12px; color: #93c5fd; font-weight: 600; margin-bottom: 6px; }
  .total-box .tamount { font-size: 38px; font-weight: 800; color: #3b82f6; font-family: monospace; }
  .total-box .tsub { font-size: 11px; color: #475569; margin-top: 8px; }

  .divider { height: 8px; }
</style>
</head>
<body>

<noscript>
<div style="background:#ef4444; color:#fff; text-align:center; padding:16px; font-size:15px; font-weight:700; direction:rtl; font-family:Arial,sans-serif;">
  âš ï¸ ×”×§×•×‘×¥ ×”×–×” ×œ× ×¢×•×‘×“ ×‘××¤×œ×™×§×¦×™×™×ª HTML Viewer. ×™×© ×œ×¤×ª×•×— ××•×ª×• ×‘×“×¤×“×¤×Ÿ â€” Chrome ××• Safari.
</div>
</noscript>
<div id="wrong-app-banner" style="display:none; background:#ef4444; color:#fff; text-align:center; padding:16px; font-size:14px; font-weight:700; direction:rtl; font-family:Arial,sans-serif;">
  âš ï¸ × ×¨××” ×©×”×§×•×‘×¥ × ×¤×ª×— ×‘××¤×œ×™×§×¦×™×” ×©××™× ×” ×“×¤×“×¤×Ÿ.<br>
  <span style="font-weight:400; font-size:13px;">×œ×—×¦×™ ×¢×œ Â·Â·Â· ××• Share â† "×¤×ª×— ×‘-Chrome" / "×¤×ª×— ×‘-Safari"</span>
</div>

<div class="header">
  <h1>××—×©×‘×•×Ÿ ×¤×¨××™×•×ª</h1>
  <p>×—×™×©×•×‘ ×¤×¨××™×™×ª ×¢×‘×•×“×” ×•×¤×¨××™×™×ª ×”×¢×“×¨×•×ª</p>
  <div style="margin-top:14px; background:rgba(251,191,36,0.08); border:1px solid rgba(251,191,36,0.25); border-radius:10px; padding:10px 16px; max-width:560px; margin-left:auto; margin-right:auto;">
    <div style="font-size:12px; color:#fbbf24; font-weight:700; margin-bottom:4px;">âš ï¸ ×›×œ×™ ×¢×–×¨ ×‘×œ×‘×“ â€” × ×‘× ×” ×¢×œ ×™×“×™ ××œ×™×¡×•×Ÿ ××œ×˜</div>
    <div style="font-size:11px; color:#fde68a; line-height:1.7;">×”×›×œ×™ ×”×–×” × ×‘× ×” ×‘××•×¤×Ÿ ×¢×¦×××™ ×•×¢×œ×•×œ×™× ×œ×”×™×•×ª ×‘×• ××™-×“×™×•×§×™×. ×™×© ×œ×‘×“×•×§ ×ª××™×“ ××•×œ ×“×£ ×”×¤×¨××™×•×ª ×”×¨×©××™ ×©×œ×š.<br>×©××ª ×œ×‘ ×œ×˜×¢×•×ª? ××©××— ×œ×“×¢×ª ×›×“×™ ×œ×©×¤×¨ ğŸ™</div>
  </div>
</div>

<div class="container">
  <div class="grid">

    <!-- LEFT: Inputs -->
    <div>
      <div class="section-title"><span>âš™ï¸ ×”×’×“×¨×•×ª ×”×¡×›×</span><div class="line"></div></div>

      <div class="input-row" style="background:rgba(255,255,255,0.02); border-color:rgba(255,255,255,0.05);">
        <label style="color:#64748b;">
          <button class="tip-btn" data-tip="tarif">?</button>
          ×ª×¢×¨×™×£ (×§×‘×•×¢)
        </label>
        <span style="font-size:13px; color:#475569; font-family:monospace; font-weight:600;">â‚ª40.49</span>
        <input type="hidden" id="tarif" value="40.49">
      </div>

      <input type="hidden" id="takara" value="5400">
      <div class="input-row" style="flex-direction: column; align-items: flex-start; gap: 10px;">
        <div style="display:flex; align-items:center; gap:6px;">
          <button class="tip-btn" data-tip="takara">?</button>
          <span style="font-size:13px; color:#cbd5e1;">×¡×•×’ ×¢×•×‘×“×ª</span>
        </div>
        <div style="display:flex; gap:8px; width:100%;">
          <button id="btn-regular" onclick="setVetek(false)" style="flex:1; padding:10px 6px; border-radius:8px; font-family:'Heebo',sans-serif; font-size:13px; font-weight:700; cursor:pointer; background:rgba(37,99,235,0.8); border:2px solid #3b82f6; color:#fff;">×¢×•×‘×“×ª ×¨×’×™×œ×”<br><span style="font-size:11px; font-weight:400;">×ª×§×¨×” â‚ª5,400</span></button>
          <button id="btn-vetek" onclick="setVetek(true)" style="flex:1; padding:10px 6px; border-radius:8px; font-family:'Heebo',sans-serif; font-size:13px; font-weight:700; cursor:pointer; background:rgba(255,255,255,0.05); border:2px solid rgba(255,255,255,0.1); color:#94a3b8;">×•×ª×™×§×”<br><span style="font-size:11px; font-weight:400;">×ª×§×¨×” â‚ª5,838.25</span></button>
        </div>
      </div>

      <div class="input-row" style="background:rgba(255,255,255,0.02); border-color:rgba(255,255,255,0.05);">
        <label style="color:#64748b;">
          <button class="tip-btn" data-tip="makdam">?</button>
          ××§×“× ×˜×™×¤×•×œ×™× (×§×‘×•×¢)
        </label>
        <span style="font-size:13px; color:#475569; font-family:monospace; font-weight:600;">Ã—2</span>
        <input type="hidden" id="makdam" value="2">
      </div>

      <div class="section-title"><span>â±ï¸ ×©×¢×•×ª ×¢×‘×•×“×”</span><div class="line"></div></div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="shaPotential">?</button>
          ×©×¢×•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª
        </label>
        <span class="unit">×©×¢×•×ª</span>
        <input type="number" inputmode="decimal" id="shaPotential" value="" placeholder="0" step="0.5" oninput="calc()">
      </div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="shaTeken">?</button>
          ×©×¢×•×ª ×ª×§×Ÿ (×œ×¤×™ ××©×¨×ª×™)
        </label>
        <span class="unit">×©×¢×•×ª</span>
        <input type="number" inputmode="decimal" id="shaTeken" value="" placeholder="0" step="0.5" oninput="calc()">
      </div>

      <div class="section-title"><span>ğŸ“… ×”×™×¢×“×¨×•×™×•×ª</span><div class="line"></div></div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="headrutMazaka">?</button>
          ×”×™×¢×“×¨×•×ª ××–×›×”
        </label>
        <span class="unit">×©×¢×•×ª</span>
        <input type="number" inputmode="decimal" id="headrutMazaka" value="" placeholder="0" step="0.5" oninput="calc()">
      </div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="headrutLoMazaka">?</button>
          ×”×™×¢×“×¨×•×ª ×œ× ××–×›×” (××—×œ×”)
        </label>
        <span class="unit">×©×¢×•×ª</span>
        <input type="number" inputmode="decimal" id="headrutLoMazaka" value="" placeholder="0" step="0.5" oninput="calc()">
      </div>

      <!-- Auto-calculated ×©×¢×•×ª ×¢×‘×•×“×” -->
      <div class="input-row" style="background:rgba(37,99,235,0.06); border-color:rgba(37,99,235,0.2);">
        <label style="color:#93c5fd;">
          <button class="tip-btn" data-tip="shaAvoda">?</button>
          ×©×¢×•×ª ×¢×‘×•×“×” (××—×•×©×‘)
        </label>
        <span class="unit" style="color:#64748b;">×©×¢×•×ª</span>
        <span id="shaAvoda_display" style="width:80px; text-align:center; font-size:14px; font-weight:700; color:#3b82f6; font-family:monospace;">0.00</span>
        <input type="hidden" id="shaAvoda" value="0">
      </div>

      <div class="section-title"><span>ğŸ“Š ×ª×¤×•×§×•×ª</span><div class="line"></div></div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="shaLaTipulit">?</button>
          ×©×¢×•×ª ×©×œ×˜
        </label>
        <span class="unit">×©×¢×•×ª</span>
        <input type="number" inputmode="decimal" id="shaLaTipulit" value="" placeholder="0" step="0.5" oninput="calc()">
      </div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="shaNosfot">?</button>
          ×©×¢×•×ª × ×•×¡×¤×•×ª
        </label>
        <span class="unit">×©×¢×•×ª</span>
        <input type="number" inputmode="decimal" id="shaNosfot" value="" placeholder="0" step="0.05" oninput="calc()">
      </div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="tifukot">?</button>
          ×›××•×ª ×ª×¤×•×§×•×ª
        </label>
        <span class="unit">×ª×¤×•×§×•×ª</span>
        <input type="number" inputmode="decimal" id="tifukot" value="" placeholder="0" step="1" oninput="calc()">
      </div>

      <div class="input-row">
        <label>
          <button class="tip-btn" data-tip="avgShnati">?</button>
          ×××•×¦×¢ ×©× ×ª×™ (12 ×—×•×“×©×™×)
        </label>
        <span class="unit">×××•×¦×¢</span>
        <input type="number" inputmode="decimal" id="avgShnati" value="" placeholder="0.00" step="0.01" min="0" max="1" oninput="calc()">
      </div>

      <!-- Reset Button -->
      <button onclick="resetFields()" style="
        margin-top: 16px; width: 100%; padding: 12px;
        background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3);
        border-radius: 8px; color: #fca5a5; font-size: 14px; font-weight: 600;
        font-family: 'Heebo', 'Arial Hebrew', 'David', Arial, sans-serif; cursor: pointer; letter-spacing: 0.02em;
      ">ğŸ”„ ××™×¤×•×¡ ×›×œ ×”×©×“×•×ª</button>
    </div>

    <!-- RIGHT: Results -->
    <div>
      <div class="section-title"><span>ğŸ”¢ × ×™×ª×•×— ×‘×™× ×™×™×</span><div class="line"></div></div>

      <div class="result-row">
        <span class="rlabel">×˜×™×¤×•×œ×™× ××©×•×§×œ×œ×™×</span>
        <span class="rvalue" id="r_tipulim">â€”</span>
      </div>
      <div class="result-row">
        <span class="rlabel">××›× ×” (×©×¢×•×ª ××•×©×§×¢×•×ª)</span>
        <span class="rvalue" id="r_mecane">â€”</span>
      </div>
      <div class="result-row">
        <span class="rlabel">×××•×¦×¢ ×˜×™×¤×•×œ×™× ×œ×ª×©×œ×•×</span>
        <span class="rvalue" id="r_avg">â€”</span>
      </div>
      <div class="result-row">
        <span class="rlabel">×¡×š ×©×¢×•×ª ×œ×ª×©×œ×•×</span>
        <span class="rvalue" id="r_totalHours">â€”</span>
      </div>

      <div class="section-title"><span>ğŸ¯ ××©×¨×” ×•×ª×§×¨×”</span><div class="line"></div></div>

      <div class="result-row">
        <span class="rlabel">××—×•×– ××©×¨×” ×‘×¤×•×¢×œ</span>
        <span class="rvalue" id="r_mishra">â€”</span>
      </div>
      <div class="result-row accent">
        <span class="rlabel">×ª×§×¨×ª ×ª×©×œ×•× ×œ×—×•×“×©</span>
        <span class="rvalue" id="r_takara">â€”</span>
      </div>

      <div class="divider"></div>

      <!-- Alert area -->
      <div id="alertArea"></div>

      <div class="section-title"><span>ğŸ’° ×¤×¨××™×•×ª</span><div class="line"></div></div>

      <div class="result-row">
        <span class="rlabel">×¤×¨××™×™×ª ×¢×‘×•×“×” (×œ×¤× ×™ ×ª×§×¨×”)</span>
        <span class="rvalue" id="r_avoda_before">â€”</span>
      </div>
      <div class="result-row accent">
        <span class="rlabel">×¤×¨××™×™×ª ×¢×‘×•×“×” ×¡××œ 1783</span>
        <span class="rvalue" id="r_avoda">â€”</span>
      </div>
      <div class="divider"></div>
      <div class="result-row">
        <span class="rlabel">×¤×¨××™×™×ª ×”×¢×“×¨×•×ª (×œ×¤× ×™ ×ª×§×¨×”)</span>
        <span class="rvalue" id="r_headrut_before">â€”</span>
      </div>
      <div class="result-row accent">
        <span class="rlabel">×¤×¨××™×™×ª ×”×¢×“×¨×•×ª ×¡××œ 1785</span>
        <span class="rvalue" id="r_headrut">â€”</span>
      </div>

      <div class="total-box">
        <div class="tlabel">×¡×š ×ª×©×œ×•× ×¤×¨××™×” ×›×¤×•×£ ×œ×ª×§×¨×”</div>
        <div class="tamount" id="r_total">â‚ª0.00</div>
        <div class="tsub" id="r_total_sub">â€”</div>
      </div>
      <div style="margin-top:8px; font-size:11px; color:#475569; text-align:center; line-height:1.6;">
        âš ï¸ ×›×œ×™ ×¢×–×¨ ×‘×œ×‘×“ â€” ×¢×©×•×™ ×œ×”×™×•×ª ××›×•×™×™×œ ×¢×“ ~â‚ª30 ××”×ª×œ×•×© ×”×¨×©××™
      </div>

      <!-- Progress toward ×ª×§×¨×” -->
      <div id="takaraProgress" style="margin-top:14px;"></div>

      <!-- Suggestions -->
      <div id="suggestArea" style="margin-top:10px;"></div>
    </div>

  </div>
</div>

<script>
function v(id) { return parseFloat(document.getElementById(id).value) || 0; }
function set(id, val, unit) {
  const el = document.getElementById(id);
  if (el) el.textContent = val + (unit ? ' ' + unit : '');
}

// ---- TOOLTIP DATA ----
// All tooltip content lives here in JS â€” safe from HTML corruption during file transfer
const TIPS = {
  tarif:          '×ª×¢×¨×™×£ ×”×¡×›× ×§×‘×•×¢: 40.49 â‚ª ×œ×©×¢×” ×œ×˜×™×¤×•×œ. ×œ× × ×™×ª×Ÿ ×œ×©×™× ×•×™.',
  takara:         '×¢×•×‘×“×ª ×¨×’×™×œ×”: ×ª×§×¨×” 5,400 â‚ª\n×•×ª×™×§×”: ×ª×§×¨×” 5,838.25 â‚ª',
  makdam:         '×‘×”×ª×¤×ª×—×•×ª ×”×™×œ×“ ×¨×™×¤×•×™ ×‘×¢×™×¡×•×§: ×›×œ ×ª×¤×•×§×” ×©×•×•×” Ã—2 ×˜×™×¤×•×œ×™× ××©×•×§×œ×œ×™×. ×œ× × ×™×ª×Ÿ ×œ×©×™× ×•×™.',
  shaPotential:   '××§×¡×™××•× ×©×¢×•×ª ×œ×—×•×“×© ×œ××©×¨×” ××œ××” (100%):\nâ€¢ ×™×•× ×¨×’×™×œ (×-×”): 8 ×©×¢×•×ª\nâ€¢ ×¢×¨×‘ ×—×’: 4 ×©×¢×•×ª\nâ€¢ ×—×•×œ ×”××•×¢×“: 5 ×©×¢×•×ª\nâ€¢ ×™×•× ×—×’: 0 ×©×¢×•×ª\nâ€¢ ×™×•× ××§×•×¦×¨ (×¤×•×¨×™×/×—× ×•×›×”/×™×•× ×”××©×¤×—×”): 8 ×©×¢×•×ª âœ“\n\nâš ï¸ ×™×•× ××§×•×¦×¨ â€” ×œ××¨×•×ª ×”×§×™×¦×•×¨ ×‘×¤×•×¢×œ, × ×¡×¤×¨ ×›×™×•× ×¢×‘×•×“×” ××œ× (8 ×©×¢×•×ª) ×œ×¦×•×¨×š ×—×™×©×•×‘ ×©×¢×•×ª ×¤×•×˜× ×¦×™××œ×™×•×ª.\n\n××©××© ×œ×—×™×©×•×‘ ×ª×§×¨×ª ×”×ª×©×œ×•× ×”×—×•×“×©×™×ª.',
  shaTeken:       '×—×©×‘×™ ×œ×¤×™ ×”×™××™× ×©××ª ×¢×•×‘×“×ª ×‘×©×‘×•×¢ ×•×›××” ×¤×¢××™× ×›×œ ×™×•× ××•×¤×™×¢ ×‘×œ×•×— ×”×©× ×” ×”×—×•×“×©×™.\n\n×œ×“×•×’××”: ××ª ×¢×•×‘×“×ª ××³ (7 ×©×¢×•×ª), ×“×³ (7 ×©×¢×•×ª), ×”×³ (8 ×©×¢×•×ª)\n×‘×—×•×“×© ×¢× 5 ×™××™ ××³, 5 ×™××™ ×“×³, 4 ×™××™ ×”×³:\n(7Ã—5) + (7Ã—5) + (8Ã—4) = 102 ×©×¢×•×ª\n\nâš ï¸ ×©×™××™ ×œ×‘ ×œ×™××™× ××™×•×—×“×™× ×œ×¤×™ ××™×–×” ×™×•× ×©×‘×•×¢ ×”× × ×•×¤×œ×™×:\nâ€¢ ×¢×¨×‘ ×—×’ â€” 50% ××©×¢×•×ª ×”×™×•× ×”×¨×’×™×œ\nâ€¢ ×—×’ â€” 0 ×©×¢×•×ª\nâ€¢ ×—×•×œ ×”××•×¢×“ â€” 62.5% ××©×¢×•×ª ×”×™×•× ×”×¨×’×™×œ\nâ€¢ ×™×•× ×‘×—×™×¨×” â€” ×œ× × ×›× ×¡ ×œ×ª×§×Ÿ, ××•×›× ×¡ ×œ×”×™×¢×“×¨×•×ª ××–×›×”\n\nğŸ”„ ×™×•× ××§×•×¦×¨ (×—× ×•×›×”/×¤×•×¨×™× ×•×›×“×³) â€” ×™×ª×¢×“×›×Ÿ ×‘×”××©×š',
  headrutMazaka:  '×”×™×¢×“×¨×•×™×•×ª ×”××–×›×•×ª ×‘×¤×¨××™×™×ª ×”×¢×“×¨×•×ª:\nâ€¢ ×—×•×¤×© ×©× ×ª×™\nâ€¢ ×™×•× ×‘×—×™×¨×”\nâ€¢ ×™×•× ×–×™×›×¨×•×Ÿ â€“ ×¢×•×‘×“ ×©×›×•×œ\nâ€¢ ×”×©×ª×œ××•×ª ××ª×—×ª ×œÖ¾3 ×™××™×\n\n××•×¤×—×ª×•×ª ××©×¢×•×ª ×”×ª×§×Ÿ ×‘×—×™×©×•×‘ ×©×¢×•×ª ×”×¢×‘×•×“×”, ×•××–×›×•×ª ×‘×¤×¨××™×” × ×¤×¨×“×ª.\n\nâš ï¸ ×× ×”×”×™×¢×“×¨×•×ª ×—×œ×” ×¢×œ ×™×•× ××§×•×¦×¨ (×¢×¨×‘ ×—×’ / ×—×•×œ ×”××•×¢×“) â€” ×”×›× ×¡ ××ª ×”×©×¢×•×ª ×”××§×•×¦×¨×•×ª ×‘×¤×•×¢×œ, ×œ× ××ª ×©×¢×•×ª ×”×™×•× ×”××œ×.',
  headrutLoMazaka:'×”×™×¢×“×¨×•×™×•×ª ×©××™× ×Ÿ ××–×›×•×ª ×‘×¤×¨××™×™×ª ×”×¢×“×¨×•×ª:\nâ€¢ ××—×œ×ª ×¢×•×‘×“\nâ€¢ ××—×œ×ª ×™×œ×“\nâ€¢ ×”×¦×”×¨×”\nâ€¢ ××—×œ×ª ×‘×Ÿ ××©×¤×—×” ××›×œ ×¡×•×’\nâ€¢ ×¢×§×‘ ×”×¨×™×•×Ÿ, ×˜×™×¤×•×œ×™ ×¤×¨×™×”\nâ€¢ ×ª××•× ×ª ×¢×‘×•×“×”\nâ€¢ × ×™×©×•××™× â€“ ×©×œ ×”×¢×•×‘×“ ××• ×‘×Ÿ/×‘×ª\nâ€¢ ×™×•× ×œ×™×“×” ×‘×Ÿ/×‘×ª\nâ€¢ ×‘×¨×™×ª ××™×œ×”\nâ€¢ ×™××™ ××‘×œ\nâ€¢ ×”×©×ª×œ××•×ª ××¢×œ 3 ×™××™×\nâ€¢ ×©×‘×™×ª×”\nâ€¢ ×‘×™×§×•×¨ ××¦×œ ×¨×•×¤× ×ª×¢×¡×•×§×ª×™\n\n××•×¤×—×ª×•×ª ××©×¢×•×ª ×”×ª×§×Ÿ ×‘×—×™×©×•×‘ ×©×¢×•×ª ×”×¢×‘×•×“×”.\n\nâš ï¸ ×× ×”×”×™×¢×“×¨×•×ª ×—×œ×” ×¢×œ ×™×•× ××§×•×¦×¨ (×¢×¨×‘ ×—×’ / ×—×•×œ ×”××•×¢×“) â€” ×”×›× ×¡ ××ª ×”×©×¢×•×ª ×”××§×•×¦×¨×•×ª ×‘×¤×•×¢×œ, ×œ× ××ª ×©×¢×•×ª ×”×™×•× ×”××œ×.',
  shaAvoda:       '×©×¢×•×ª ×¢×‘×•×“×” = ×©×¢×•×ª ×ª×§×Ÿ âˆ’ ×”×™×¢×“×¨×•×ª ××–×›×” âˆ’ ××—×œ×” âˆ’ ×©×œ×˜ + ×©×¢×•×ª × ×•×¡×¤×•×ª\n\n×©×¢×•×ª ××œ×• ×”×Ÿ ×”××›× ×” ×œ×—×™×©×•×‘ ×××•×¦×¢ ×”×˜×™×¤×•×œ×™×.\n×©×œ×˜ ×•×©×¢×•×ª × ×•×¡×¤×•×ª ××•×–× ×•×ª ×‘×¡×¢×™×£ ×ª×¤×•×§×•×ª.',
  shaLaTipulit:   '×©×¢×•×ª ×¢×‘×•×“×” ×œ×œ× ×§×•×“ ×ª×¤×•×§×” ×‘-Clicks, ×©××•×©×¨×• ××¨××© ×¢×œ ×™×“×™ ×”×× ×”×œ×ª (× ×™×œ×™ / ××™×¨×‘).\n\n×œ×“×•×’××”:\nâ€¢ ××—×§×¨\nâ€¢ ×”×›× ×ª ××¡××›×™×\nâ€¢ ×¢×‘×•×“×” ××“××™× ×™×¡×˜×¨×˜×™×‘×™×ª\n\nâš ï¸ ×©×œ×˜ ××•×¤×—×ª ××©×¢×•×ª ×”×¢×‘×•×“×” ×•×œ× × ×›× ×¡ ×œ××›× ×” â€” ×¤×—×•×ª ×©×œ×˜ = ×××•×¦×¢ ×’×‘×•×” ×™×•×ª×¨ = ×¤×¨××™×” ×’×‘×•×”×” ×™×•×ª×¨.',
  shaNosfot:      '×©×¢×•×ª ××¢×‘×¨ ×œ×©×¢×•×ª ×”×ª×§×Ÿ ×©×œ×š, ×©××•×¤×™×¢×•×ª ×‘×“×£ ×”×¤×¨××™×•×ª.\n×œ×¨×•×‘ ××“×•×‘×¨ ×‘×“×§×•×ª ×‘×•×“×“×•×ª â€” ×œ× ××©×”×• ×©××ª×›× × ×™×, ×¤×©×•×˜ ××¢×ª×™×§×™× ××”×“×£.\n\n× ×›× ×¡×•×ª ×œ××›× ×” ×•×œ×¡×š ×©×¢×•×ª ×œ×ª×©×œ×•×.',
  tifukot:        '×§×•×“×™ ×ª×¤×•×§×” ×‘-Clicks:\nâ€¢ 50011 - ×˜×™×¤×•×œ\nâ€¢ 50008 - ××‘×—×•×Ÿ\nâ€¢ 50016 - ×™×©×™×‘×”\nâ€¢ 50038 - ×“×•×—\nâ€¢ 50042 - ×™×©×™×‘×” ×¢× ×’× × ×ª\n\n×›×œ ×§×•×“ = ×ª×¤×•×§×” ××—×ª.',
  avgShnati:      '×××•×¦×¢ ×”×˜×™×¤×•×œ×™× ×œ×ª×©×œ×•× ×©×œ 12 ×”×—×•×“×©×™× ×”×§×•×“××™×.\n××©××© ×œ×—×™×©×•×‘ ×¤×¨××™×™×ª ×”×”×¢×“×¨×•×ª.\n×”×›× ×¡ ×™×“× ×™×ª ××”×ª×œ×•×© ×”×—×•×“×©×™.',
  shalet:         '×›×©××¢×‘×™×¨×™× ×©×¢×•×ª ×¢×‘×•×“×” ×œ×©×œ×˜:\nâ€¢ ×”××›× ×” ×§×˜×Ÿ â† ×××•×¦×¢ ×¢×•×œ×”\nâ€¢ ×¡×š ×©×¢×•×ª ×œ×ª×©×œ×•× ×œ× ××©×ª× ×”\nâ€¢ ×”×ª×§×¨×” ×œ× ××©×ª× ×”\n\n×œ×›×Ÿ ×”×¤×¨××™×” ×¢×•×œ×” ×‘×œ×™ ×œ×©× ×•×ª ××ª ×”×ª×§×¨×”!\n\n××’×‘×œ×”: ×©×œ×˜ â‰¤ ×©×¢×•×ª ×¢×‘×•×“×” (×›×œ×œ 50%)'
};

// Build tooltip popup element once, reuse it
const tipPopup = document.createElement('div');
Object.assign(tipPopup.style, {
  position: 'fixed',
  zIndex: '9999',
  width: '240px',
  display: 'none',
  background: '#1e293b',
  color: '#e2e8f0',
  borderRadius: '8px',
  padding: '10px 14px',
  fontSize: '12px',
  lineHeight: '1.7',
  whiteSpace: 'pre-line',
  textAlign: 'right',
  border: '1px solid rgba(255,255,255,0.1)',
  boxShadow: '0 8px 32px rgba(0,0,0,0.6)',
  pointerEvents: 'none',
  direction: 'rtl',
  fontFamily: "Heebo, 'Arial Hebrew', Arial, sans-serif"
});
document.body.appendChild(tipPopup);

let activeTipBtn = null;

function showTip(btn) {
  const key = btn.getAttribute('data-tip');
  if (!key || !TIPS[key]) return;
  if (activeTipBtn === btn) { hideTip(); return; }
  hideTip();
  activeTipBtn = btn;
  btn.classList.add('open');
  tipPopup.textContent = TIPS[key];
  // Show offscreen first to measure height
  tipPopup.style.visibility = 'hidden';
  tipPopup.style.display = 'block';
  const popupWidth = 240;
  const popupHeight = tipPopup.offsetHeight;
  const rect = btn.getBoundingClientRect();
  // Horizontal: align right edge of popup with right edge of button, clamp to viewport
  let left = rect.right - popupWidth;
  if (left < 8) left = 8;
  if (left + popupWidth > window.innerWidth - 8) left = window.innerWidth - popupWidth - 8;
  // Vertical: above button, flip below if not enough space
  let top = rect.top - popupHeight - 8;
  if (top < 8) top = rect.bottom + 8;
  tipPopup.style.left = left + 'px';
  tipPopup.style.top = top + 'px';
  tipPopup.style.visibility = 'visible';
}

function hideTip() {
  if (activeTipBtn) { activeTipBtn.classList.remove('open'); activeTipBtn = null; }
  tipPopup.style.display = 'none';
}

// Wire up all tip buttons via hover (event delegation)
document.addEventListener('mouseover', function(e) {
  const btn = e.target.closest('[data-tip]');
  if (btn) showTip(btn);
});
document.addEventListener('mouseout', function(e) {
  const btn = e.target.closest('[data-tip]');
  if (btn) hideTip();
});

// Touch support for mobile
document.addEventListener('touchstart', function(e) {
  const btn = e.target.closest('[data-tip]');
  if (btn) {
    e.preventDefault();
    if (activeTipBtn === btn) { hideTip(); return; }
    showTip(btn);
  } else {
    hideTip();
  }
}, { passive: false });


// Detect if running in a limited viewer (no proper window.location, sandboxed webview, etc.)
(function() {
  try {
    // HTML viewer apps often have no real navigation or are file:// with restrictions
    // A simple heuristic: if localStorage throws or UA looks like a webview
    const ua = navigator.userAgent || '';
    const isWebView = /; wv\)/.test(ua); // Android WebView flag
    if (isWebView) {
      document.getElementById('wrong-app-banner').style.display = 'block';
    }
  } catch(e) {
    document.getElementById('wrong-app-banner').style.display = 'block';
  }
})();

function calc() {
  const tarif = v('tarif');
  const takara = v('takara');
  const makdam = v('makdam');
  const shaPotential = v('shaPotential');
  const shaLaTipulit = v('shaLaTipulit');
  const shaTeken = v('shaTeken');
  const headrutMazaka = v('headrutMazaka');
  const headrutLoMazaka_val = v('headrutLoMazaka');
  const shaNosfot = v('shaNosfot');
  const shaAvoda = Math.max(0, shaTeken - headrutMazaka - headrutLoMazaka_val - shaLaTipulit + shaNosfot);
  // Update hidden field and display
  document.getElementById('shaAvoda').value = shaAvoda;
  document.getElementById('shaAvoda_display').textContent = shaAvoda.toFixed(2);
  const tifukot = v('tifukot');
  const avgShnati = v('avgShnati');

  // Core calcs
  const tipulimMushkalim = tifukot * makdam;
  const mecane = shaAvoda;
  const rawAvg = mecane > 0 ? tipulimMushkalim / mecane : 0;
  const avgTipulim = Math.min(Math.max(rawAvg - 1, 0), 1);
  const totalHoursLeTashlum = Math.max(0, shaTeken - headrutMazaka - headrutLoMazaka_val + shaNosfot);

  // Threshold check: coded hours / total clocked hours >= 50%
  // Threshold: coded hours / actual hours present (excluding absences entirely)
  const actualHoursPresent = shaAvoda + shaLaTipulit; // ×¢×‘×•×“×” + ×©×œ×˜ (both = hours you were there)
  const codedPct = actualHoursPresent > 0 ? shaAvoda / actualHoursPresent : 0;
  const belowThreshold = codedPct < 0.5;

  // ××—×•×– ××©×¨×” ×‘×¤×•×¢×œ
  const mishraHours = Math.max(0, shaTeken - headrutLoMazaka_val + shaNosfot);
  const mishraPct = shaPotential > 0 ? mishraHours / shaPotential : 0;
  const takaraHodesh = mishraPct * takara;

  // Gate: nothing pays if monthly avg <= 0 (rawAvg must exceed 1) OR below 50% threshold
  const belowAvgGate = avgTipulim <= 0;
  const noPayment = belowThreshold || belowAvgGate;

  // ×¤×¨××™×™×ª ×¢×‘×•×“×”
  const premiatAvodaBefore = noPayment ? 0 : totalHoursLeTashlum * avgTipulim * tarif;
  const premiatAvoda = Math.min(premiatAvodaBefore, takaraHodesh);

  // ×¤×¨××™×™×ª ×”×¢×“×¨×•×ª
  const premiatHeadrutBefore = noPayment ? 0 : headrutMazaka * avgShnati * tarif;
  const remainingCap = Math.max(0, takaraHodesh - premiatAvoda);
  const premiatHeadrut = Math.min(premiatHeadrutBefore, remainingCap);

  const total = premiatAvoda + premiatHeadrut;

  // To reach avg = 1 after subtracting 1, need raw avg = 2, so tipulim = mecane * 2
  const tifukotNeeded = mecane > 0 ? Math.ceil((mecane * 2) / makdam) : 0;
  const shortfall = Math.max(0, tifukotNeeded - tifukot);

  // Update UI
  set('r_tipulim', tipulimMushkalim.toFixed(0), '×˜×™×¤×•×œ×™×');
  set('r_mecane', mecane.toFixed(2), '×©×¢×•×ª');
  set('r_avg', avgTipulim.toFixed(3), avgTipulim >= 1 ? '(××§×¡×™××•× âœ“)' : '');
  set('r_totalHours', totalHoursLeTashlum.toFixed(2), '×©×¢×•×ª');
  set('r_mishra', (mishraPct * 100).toFixed(1), '%');
  set('r_takara', 'â‚ª' + takaraHodesh.toFixed(2));
  set('r_avoda_before', 'â‚ª' + premiatAvodaBefore.toFixed(2));
  set('r_avoda', 'â‚ª' + premiatAvoda.toFixed(2));
  set('r_headrut_before', 'â‚ª' + premiatHeadrutBefore.toFixed(2));
  set('r_headrut', 'â‚ª' + premiatHeadrut.toFixed(2));
  document.getElementById('r_total').textContent = 'â‚ª' + total.toFixed(2);
  document.getElementById('r_total_sub').textContent = '×¡××œ 1783: â‚ª' + premiatAvoda.toFixed(2) + ' | ×¡××œ 1785: â‚ª' + premiatHeadrut.toFixed(2);

  // ---- PROGRESS TOWARD ×ª×§×¨×” ----
  const gapToTakara = takaraHodesh - total;
  const progressPct = takaraHodesh > 0 ? Math.min(total / takaraHodesh * 100, 100) : 0;
  const atOrOverCap = total >= takaraHodesh - 0.5;

  const progressColor = progressPct >= 100 ? '#22c55e' : progressPct >= 75 ? '#3b82f6' : progressPct >= 40 ? '#fbbf24' : '#ef4444';

  document.getElementById('takaraProgress').innerHTML = `
    <div style="background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:10px; padding:12px 14px;">
      <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
        <span style="font-size:12px; color:#94a3b8;">×”×ª×§×“××•×ª ×œ×ª×§×¨×”</span>
        <span style="font-size:12px; font-weight:700; color:${progressColor};">${progressPct.toFixed(1)}%</span>
      </div>
      <div style="background:rgba(255,255,255,0.07); border-radius:99px; height:10px; overflow:hidden;">
        <div style="width:${progressPct}%; height:100%; background:${progressColor}; border-radius:99px; transition:width 0.4s;"></div>
      </div>
      <div style="display:flex; justify-content:space-between; margin-top:7px;">
        <span style="font-size:11px; color:#64748b;">×¤×¨××™×”: â‚ª${total.toFixed(2)}</span>
        <span style="font-size:11px; color:#64748b;">×ª×§×¨×”: â‚ª${takaraHodesh.toFixed(2)}</span>
      </div>
      ${atOrOverCap ? '' : `<div style="margin-top:6px; font-size:12px; color:#fbbf24; text-align:center;">×—×¡×¨: â‚ª${gapToTakara.toFixed(2)}</div>`}
    </div>`;

  // ---- THRESHOLD + SUGGESTIONS ----
  const alertArea = document.getElementById('alertArea');
  const suggestArea = document.getElementById('suggestArea');

  if (belowThreshold) {
    alertArea.innerHTML = `<div class="alert danger">
      <div class="atitle">âš ï¸ ×¡×£ ×ª×¤×•×§×ª×™ ×œ× ×”×•×©×’</div>
      <div class="abody">×©×¢×•×ª ×ª×¤×•×§×ª×™×•×ª: ${(codedPct*100).toFixed(1)}% ××©×¢×•×ª ×”× ×•×›×—×•×ª ×‘×¤×•×¢×œ<br>× ×“×¨×© ×œ×¤×—×•×ª 50% ××©×¢×•×ª ×”× ×•×›×—×•×ª (×œ× ×›×•×œ×œ ×”×™×¢×“×¨×•×™×•×ª) ×¢× ×§×•×“ ×‘-Clicks ×œ×§×‘×œ×ª ×¤×¨××™×”.</div>
    </div>`;
    suggestArea.innerHTML = '';
  } else if (belowAvgGate) {
    alertArea.innerHTML = `<div class="alert danger">
      <div class="atitle">âš ï¸ ×©×¢×•×ª ×¢×‘×•×“×” ×œ× ××¡×¤×™×§ ×ª×¤×•×§×ª×™×•×ª</div>
      <div class="abody">×œ×¤×—×•×ª ××—×¦×™×ª ××©×¢×•×ª ×”×¢×‘×•×“×” ×©×œ×š ×¦×¨×™×›×•×ª ×œ×”×™×•×ª ×ª×¤×•×§×ª×™×•×ª ×›×“×™ ×œ×§×‘×œ ×¤×¨××™×” ×›×œ×©×”×™ â€” ×›×•×œ×œ ×¤×¨××™×™×ª ×”×¢×“×¨×•×ª.</div>
    </div>`;
    suggestArea.innerHTML = '';
  } else if (atOrOverCap) {
    alertArea.innerHTML = `<div class="alert success">
      <div class="atitle">ğŸ‰ ×”×’×¢×ª ×œ×ª×§×¨×”!</div>
      <div class="abody">×¤×¨××™×” ××§×¡×™××œ×™×ª ×œ×—×•×“×© ×–×” ×”×•×©×’×”.</div>
    </div>`;
    suggestArea.innerHTML = '';
  } else {
    // Build suggestions
    let suggestions = '';

    // Option A: more ×ª×¤×•×§×•×ª (only if avg < 1)
    if (avgTipulim < 1) {
      // How many more ×ª×¤×•×§×•×ª needed to close the gap?
      // gap = takaraHodesh - total = takaraHodesh - (totalHoursLeTashlum * avgTipulim * tarif) - premiatHeadrut
      // We need: totalHoursLeTashlum * newAvg * tarif + premiatHeadrut >= takaraHodesh
      // newAvg = (takaraHodesh - premiatHeadrut) / (totalHoursLeTashlum * tarif)
      const neededAvg = totalHoursLeTashlum > 0 && tarif > 0
        ? (takaraHodesh - premiatHeadrutBefore) / (totalHoursLeTashlum * tarif)
        : 0;
      const cappedNeededAvg = Math.min(neededAvg, 1);
      // rawAvg needed = neededAvg + 1
      const neededRawAvg = cappedNeededAvg + 1;
      const neededTipulim = Math.ceil(neededRawAvg * mecane);
      const extraTifukot = Math.max(0, Math.ceil((neededTipulim - tipulimMushkalim) / makdam));

      if (extraTifukot > 0) {
        suggestions += `<div class="alert warning" style="margin-bottom:8px;">
          <div class="atitle">ğŸ“‹ ××¤×©×¨×•×ª ××³: ×¢×•×“ ×ª×¤×•×§×•×ª</div>
          <div class="abody">×”×•×¡×™×¤×™ <strong>${extraTifukot} ×ª×¤×•×§×•×ª</strong> × ×•×¡×¤×•×ª ×‘-Clicks ×›×“×™ ×œ×¡×’×•×¨ ×¤×¢×¨ ×©×œ â‚ª${gapToTakara.toFixed(2)}<br>
          <span style="font-size:11px; opacity:0.8;">×›×¨×’×¢: ${tifukot} ×ª×¤×•×§×•×ª | × ×“×¨×©: ${tifukot + extraTifukot}</span></div>
        </div>`;
      }
    }

    // --- OPTION B: convert ×¢×‘×•×“×” hours to ×©×œ×˜ ---
    // Moving hours from ×¢×‘×•×“×” to ×©×œ×˜:
    // - ××›× ×” shrinks â†’ ×××•×¦×¢ rises (same ×ª×¤×•×§×•×ª, fewer denominator hours)
    // - ×¡×š ×©×¢×•×ª ×œ×ª×©×œ×•× stays SAME (total clocked hours unchanged)
    // - Ceiling stays SAME (total clocked hours unchanged)
    // Constraint: ×©×œ×˜ â‰¤ ×©×¢×•×ª ×¢×‘×•×“×” (50% rule)
    const availableShalet = Math.max(0, shaAvoda);  // shaAvoda already excludes ×©×œ×˜

    if (availableShalet > 0.1 && avgTipulim < 1) {
      // Find how much ×©×œ×˜ needed to hit ×ª×§×¨×” via numerical search
      const targetPremium = Math.max(0, takaraHodesh - premiatHeadrutBefore);
      let shaletNeeded = null;
      for (let x = 0.5; x <= availableShalet + 0.5; x += 0.5) {
        const newMecane = Math.max(mecane - x, 0.01);
        const newAvg = Math.min(Math.max(tipulimMushkalim / newMecane - 1, 0), 1);
        const newPremium = totalHoursLeTashlum * newAvg * tarif;
        if (newPremium >= targetPremium) {
          shaletNeeded = x;
          break;
        }
      }

      if (shaletNeeded !== null) {
        suggestions += `<div class="alert warning">
          <div class="atitle">ğŸ• ××¤×©×¨×•×ª ×‘×³: ×”×¢×‘×¨ ×©×¢×•×ª ×œ×©×œ×˜
            <button class="tip-btn" data-tip="shalet" style="font-size:9px; width:15px; height:15px; margin-right:6px;">?</button>
          </div>
          <div class="abody">×”×¢×‘×™×¨×™ <strong>${shaletNeeded.toFixed(1)} ×©×¢×•×ª</strong> ××©×¢×•×ª ×¢×‘×•×“×” ×œ×©×œ×˜<br>
          <span style="font-size:11px; opacity:0.8;">×©×œ×˜: ${shaLaTipulit} â†’ ${(shaLaTipulit + shaletNeeded).toFixed(1)} | ××§×¡×™××•× ××¤×©×¨×™: ${shaAvoda.toFixed(1)}</span></div>
        </div>`;
      } else {
        suggestions += `<div class="alert warning">
          <div class="atitle">ğŸ• ××¤×©×¨×•×ª ×‘×³: ×”×¢×‘×¨ ×©×¢×•×ª ×œ×©×œ×˜
            <button class="tip-btn" data-tip="shalet" style="font-size:9px; width:15px; height:15px; margin-right:6px;">?</button>
          </div>
          <div class="abody">×”×¢×‘×™×¨×™ ××ª ×›×œ <strong>${availableShalet.toFixed(1)} ×©×¢×•×ª</strong> ×”×–××™× ×•×ª ×œ×©×œ×˜ â€” ×™×§×¨×‘ ×œ×ª×§×¨×” ××š ×œ× ×™×¡×¤×™×§ ×œ×‘×“<br>
          <span style="font-size:11px; opacity:0.8;">×©×œ×˜: ${shaLaTipulit} â†’ ${(shaLaTipulit + availableShalet).toFixed(1)} | ××§×¡×™××•×: ${shaAvoda.toFixed(1)}</span></div>
        </div>`;
      }
    }

    if (!suggestions) {
      suggestions = `<div class="alert warning">
        <div class="atitle">ğŸ’¡ ×××•×¦×¢ ××§×¡×™××œ×™ â€” ×¦×¨×™×š ×¢×•×“ ×©×¢×•×ª</div>
        <div class="abody">×”×××•×¦×¢ ×›×‘×¨ 1.0 ×•××™×Ÿ ×©×œ×˜ × ×•×¡×£ ×–××™×Ÿ. ×›×“×™ ×œ×”×’×™×¢ ×œ×ª×§×¨×” â€” ×¦×¨×™×š ×¢×•×“ ×©×¢×•×ª ×¢×‘×•×“×” ×‘×—×•×“×© ×–×”.</div>
      </div>`;
    }

    alertArea.innerHTML = '';
    suggestArea.innerHTML = `<div style="font-size:11px; font-weight:700; color:#475569; text-transform:uppercase; letter-spacing:0.08em; margin-bottom:8px;">ğŸ’¡ ×”×¦×¢×•×ª ×œ×”×’×“×œ×ª ×”×¤×¨××™×”</div>` + suggestions;
  }
}

function setVetek(isVetek) {
  document.getElementById('takara').value = isVetek ? 5838.25 : 5400;
  document.getElementById('btn-regular').style.background = isVetek ? 'rgba(255,255,255,0.05)' : 'rgba(37,99,235,0.8)';
  document.getElementById('btn-regular').style.border = isVetek ? '2px solid rgba(255,255,255,0.1)' : '2px solid #3b82f6';
  document.getElementById('btn-regular').style.color = isVetek ? '#94a3b8' : '#fff';
  document.getElementById('btn-vetek').style.background = isVetek ? 'rgba(37,99,235,0.8)' : 'rgba(255,255,255,0.05)';
  document.getElementById('btn-vetek').style.border = isVetek ? '2px solid #3b82f6' : '2px solid rgba(255,255,255,0.1)';
  document.getElementById('btn-vetek').style.color = isVetek ? '#fff' : '#94a3b8';
  calc();
}

function resetFields() {
  ['shaPotential','shaTeken','shaNosfot','shaLaTipulit','headrutMazaka','headrutLoMazaka','tifukot','avgShnati'].forEach(id => {
    document.getElementById(id).value = '';
  });
  calc();
}

// Run on load
calc();
</script>
</body>
</html>
